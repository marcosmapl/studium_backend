generator client {
    provider = "prisma-client-js"
    // previewFeatures = ["driverAdapters"]
}

datasource db {
    provider = "mysql"
}

model UnidadeFederativa {
    id        Int    @id @default(autoincrement())
    descricao String @unique
    sigla     String @unique

    cidades  Cidade[]

    @@index([descricao])
    @@map("unidade_federativa")
}

model Cidade {
    id        Int    @id @default(autoincrement())
    descricao String

    unidadeFederativaId Int               @map("unidade_federativa_id")
    unidadeFederativa   UnidadeFederativa @relation(fields: [unidadeFederativaId], references: [id])

    usuarios Usuario[]

    @@unique([descricao, unidadeFederativaId])
    @@index([unidadeFederativaId], map: "cidade__unidade_federativa_id_fkey")
    @@map("cidade")
}

model GeneroUsuario {
    id        Int       @id @default(autoincrement())
    descricao String    @unique
    usuarios  Usuario[]

    @@index([descricao])
    @@map("genero_usuario")
}

model SituacaoUsuario {
    id        Int    @id @default(autoincrement())
    descricao String @unique

    usuarios Usuario[]

    @@index([descricao])
    @@map("situacao_usuario")
}

model GrupoUsuario {
    id        Int       @id @default(autoincrement())
    descricao String    @unique
    usuarios  Usuario[]

    @@map("grupo_usuario")
}

model Usuario {
    id             Int       @id @default(autoincrement())
    nome           String
    sobrenome      String
    username       String    @unique
    password       String
    email          String    @unique
    dataNascimento DateTime? @map("data_nascimento")
    ultimoAcesso   DateTime  @default(now()) @map("ultimo_acesso")
    fotoUrl        String?   @db.VarChar(500)
    createdAt      DateTime  @default(now()) @map("created_at")
    updatedAt      DateTime  @updatedAt @map("updated_at")

    generoUsuario   GeneroUsuario @relation(fields: [generoUsuarioId], references: [id])
    generoUsuarioId Int           @map("genero_id")

    situacaoUsuario   SituacaoUsuario @relation(fields: [situacaoUsuarioId], references: [id])
    situacaoUsuarioId Int             @map("situacao_id")

    cidade   Cidade @relation(fields: [cidadeId], references: [id])
    cidadeId Int    @map("cidade_id")

    grupoUsuario   GrupoUsuario @relation(fields: [grupoUsuarioId], references: [id])
    grupoUsuarioId Int          @map("grupo_usuario_id")

    planosEstudo PlanoEstudo[]

    @@index([username])
    @@index([email])
    @@index([generoUsuarioId], map: "usuario__genero_id_fkey")
    @@index([grupoUsuarioId], map: "usuario__grupo_id_fkey")
    @@index([cidadeId], map: "usuario__cidade_id_fkey")
    @@index([situacaoUsuarioId], map: "usuario__situacao_id_fkey")
    @@map("usuario")
}

model Disciplina {
    id              Int      @id @default(autoincrement())
    titulo          String
    descricao       String?
    cor             String   @default("#FFFFFF")
    questoesAcertos Int      @default(0) @map("questoes_acertos")
    questoesErros   Int      @default(0) @map("questoes_erros")
    tempoEstudo     Float    @default(0.0) @map("tempo_estudo")
    paginasLidas    Int      @default(0) @map("paginas_lidas")
    concluido       Boolean  @default(false)
    observacoes     String?
    createdAt       DateTime @default(now()) @map("created_at")
    updatedAt       DateTime @updatedAt @map("updated_at")

    planoId Int         @map("plano_id")
    plano   PlanoEstudo @relation(fields: [planoId], references: [id])

    topicos Topico[]

    sessoesEstudo SessaoEstudo[]

    revisoes                Revisao[]
    disciplinaPlanejamentos DisciplinaPlanejamento[]

    @@unique([titulo, planoId])
    @@index([titulo])
    @@index([planoId], map: "disciplina__plano_id_fkey")
    @@map("disciplina")
}

model SituacaoTopico {
    id        Int    @id @default(autoincrement())
    descricao String @unique

    topicos Topico[]

    @@index([descricao])
    @@map("situacao_topico")
}

model Topico {
    id              Int      @id @default(autoincrement())
    titulo          String
    ordem           Int
    concluido       Boolean  @default(false)
    estabilidade    Float    @default(1.0)
    dificuldade     Float    @default(5.0)
    observacoes     String?
    createdAt       DateTime @default(now()) @map("created_at")
    updatedAt       DateTime @updatedAt @map("updated_at")

    disciplinaId Int        @map("disciplina_id")
    disciplina   Disciplina @relation(fields: [disciplinaId], references: [id])

    situacaoId Int            @map("situacao_id")
    situacao   SituacaoTopico @relation(fields: [situacaoId], references: [id])

    sessoesEstudo SessaoEstudo[]

    revisoes Revisao[]

    @@unique([titulo, disciplinaId])
    @@index([titulo])
    @@index([disciplinaId], map: "topico__disciplina_id_fkey")
    @@index([situacaoId], map: "topico__situacao_id_fkey")
    @@map("topico")
}

// t = -S x ln(0.9)
// Difícil = 1.15
// Mediano = 1.40
// Fácil = 1.80

model CategoriaSessao {
    id        Int    @id @default(autoincrement())
    descricao String @unique

    sessoesEstudo SessaoEstudo[]

    @@index([descricao])
    @@map("categoria_sessao")
}

model SituacaoSessao {
    id        Int    @id @default(autoincrement())
    descricao String @unique

    sessoesEstudo SessaoEstudo[]

    @@index([descricao])
    @@map("situacao_sessao")
}

model SessaoEstudo {
    id               Int      @id @default(autoincrement())
    dataInicio       DateTime @default(now()) @map("data_inicio")
    dataTermino      DateTime @default(now()) @map("data_termino")
    questoesAcertos  Int      @default(0) @map("questoes_acertos")
    questoesErros    Int      @default(0) @map("questoes_erros")
    tempoEstudo      Float    @default(0.0) @map("tempo_estudo")
    paginasLidas     Int      @default(0) @map("paginas_lidas")
    topicoFinalizado Boolean  @default(false) @map("topico_finalizado")
    observacoes      String?
    createdAt        DateTime @default(now()) @map("created_at")
    updatedAt        DateTime @updatedAt @map("updated_at")

    planoEstudoId Int         @map("plano_estudo_id")
    planoEstudo   PlanoEstudo @relation(fields: [planoEstudoId], references: [id])

    disciplinaId Int        @map("disciplina_id")
    disciplina   Disciplina @relation(fields: [disciplinaId], references: [id])

    topicoId Int    @map("topico_id")
    topico   Topico @relation(fields: [topicoId], references: [id])

    categoriaSessaoId Int             @map("categoria_id")
    categoriaSessao   CategoriaSessao @relation(fields: [categoriaSessaoId], references: [id])

    situacaoSessaoId Int            @map("situacao_id")
    situacaoSessao   SituacaoSessao @relation(fields: [situacaoSessaoId], references: [id])

    @@index([dataInicio])
    @@index([dataTermino])
    @@index([topicoFinalizado])
    @@index([planoEstudoId], map: "sessao_estudo__plano_estudo_id_fkey")
    @@index([disciplinaId], map: "sessao_estudo__disciplina_id_fkey")
    @@index([topicoId], map: "sessao_estudo__topico_id_fkey")
    @@index([categoriaSessaoId], map: "sessao_estudo__categoria_sessao_id_fkey")
    @@index([situacaoSessaoId], map: "sessao_estudo__situacao_sessao_id_fkey")
    @@map("sessao_estudo")
}

model CategoriaRevisao {
    id        Int    @id @default(autoincrement())
    descricao String @unique

    revisoes Revisao[]

    @@index([descricao])
    @@map("categoria_revisao")
}

model SituacaoRevisao {
    id        Int    @id @default(autoincrement())
    descricao String @unique

    revisoes Revisao[]

    @@index([descricao])
    @@map("situacao_revisao")
}

model Revisao {
    id              Int       @id @default(autoincrement())
    numero          Int
    dataProgramada  DateTime  @map("data_programada")
    dataRealizada   DateTime? @map("data_realizada")
    tempoEstudo     Float     @default(0.0) @map("tempo_estudo")
    questoesAcertos Int       @default(0) @map("questoes_acertos")
    questoesErros   Int       @default(0) @map("questoes_erros")
    desempenho      Int       @default(0)

    categoriaRevisaoId Int              @map("categoria_id")
    categoriaRevisao   CategoriaRevisao @relation(fields: [categoriaRevisaoId], references: [id])

    situacaoRevisaoId Int             @map("situacao_id")
    situacaoRevisao   SituacaoRevisao @relation(fields: [situacaoRevisaoId], references: [id])

    planoEstudoId Int         @map("plano_estudo_id")
    planoEstudo   PlanoEstudo @relation(fields: [planoEstudoId], references: [id])

    disciplinaId Int        @map("disciplina_id")
    disciplina   Disciplina @relation(fields: [disciplinaId], references: [id])

    topicoId Int    @map("topico_id")
    topico   Topico @relation(fields: [topicoId], references: [id])

    @@index([dataProgramada])
    @@index([dataRealizada])
    @@index([categoriaRevisaoId], map: "revisao__categoria_revisao_id_fkey")
    @@index([situacaoRevisaoId], map: "revisao__situacao_revisao_id_fkey")
    @@index([planoEstudoId], map: "revisao__plano_estudo_id_fkey")
    @@index([disciplinaId], map: "revisao__disciplina_id_fkey")
    @@index([topicoId], map: "revisao__topico_id_fkey")
    @@map("revisao")
}

model SituacaoPlano {
    id        Int    @id @default(autoincrement())
    descricao String @unique

    planosEstudo PlanoEstudo[]

    @@index([descricao])
    @@map("situacao_plano")
}

model PlanoEstudo {
    id              Int      @id @default(autoincrement())
    titulo          String
    descricao       String?
    questoesAcertos Int      @default(0) @map("questoes_acertos")
    questoesErros   Int      @default(0) @map("questoes_erros")
    tempoEstudo     Float    @default(0.0) @map("tempo_estudo")
    paginasLidas    Int      @default(0) @map("paginas_lidas")
    concluido       Boolean  @default(false)
    observacoes     String?
    createdAt       DateTime @default(now()) @map("created_at")
    updatedAt       DateTime @updatedAt @map("updated_at")

    usuarioId Int     @map("usuario_id")
    usuario   Usuario @relation(fields: [usuarioId], references: [id])

    situacaoId Int           @map("situacao_id")
    situacao   SituacaoPlano @relation(fields: [situacaoId], references: [id])

    disciplinas Disciplina[]
    sessoesEstudo SessaoEstudo[]
    revisoes      Revisao[]
    planejamentos Planejamento[]

    @@unique([titulo, usuarioId])
    @@index([titulo])
    @@index([usuarioId], map: "plano_estudo__usuario_id_fkey")
    @@index([situacaoId], map: "plano_estudo__situacao_id_fkey")
    @@map("plano_estudo")
}

model DisciplinaPlanejamento {
    id            Int      @id @default(autoincrement())
    importancia   Decimal  @db.Decimal(10, 2) // Peso da disciplina (0-10)
    conhecimento  Decimal  @db.Decimal(10, 2) // Nível conhecimento (0-10)
    horasSemanais Float    @map("horas_semanais") // Horas alocadas
    observacoes   String?
    createdAt     DateTime @default(now()) @map("created_at")
    updatedAt     DateTime @updatedAt @map("updated_at")

    planejamentoId Int          @map("planejamento_id")
    planejamento   Planejamento @relation(fields: [planejamentoId], references: [id])

    disciplinaId Int        @map("disciplina_id")
    disciplina   Disciplina @relation(fields: [disciplinaId], references: [id])

    alocacoes AlocacaoHorario[]

    @@unique([planejamentoId, disciplinaId])
    @@index([planejamentoId])
    @@index([disciplinaId])
    @@map("disciplina_planejamento")
}

model DiaEstudo {
    id              Int      @id @default(autoincrement())
    diaSemana       Int      @map("dia_semana") @db.TinyInt // 0=Domingo, 1=Segunda, ..., 6=Sábado
    horasPlanejadas Float    @map("horas_planejadas")
    ativo           Boolean  @default(false)
    createdAt       DateTime @default(now()) @map("created_at")
    updatedAt       DateTime @updatedAt @map("updated_at")

    planejamentoId Int          @map("planejamento_id")
    planejamento   Planejamento @relation(fields: [planejamentoId], references: [id])

    alocacoes AlocacaoHorario[]

    @@unique([diaSemana, planejamentoId])
    @@index([planejamentoId])
    @@index([diaSemana])
    @@map("dia_estudo")
}

model AlocacaoHorario {
    id            Int      @id @default(autoincrement())
    horasAlocadas Float    @map("horas_alocadas")
    ordem         Int // Ordem da disciplina no dia
    observacoes   String?
    createdAt     DateTime @default(now()) @map("created_at")
    updatedAt     DateTime @updatedAt @map("updated_at")

    diaEstudoId Int       @map("dia_estudo_id")
    diaEstudo   DiaEstudo @relation(fields: [diaEstudoId], references: [id])

    disciplinaCronogramaId Int                    @map("disciplina_cronograma_id")
    disciplinaCronograma   DisciplinaPlanejamento @relation(fields: [disciplinaCronogramaId], references: [id])

    @@unique([diaEstudoId, disciplinaCronogramaId])
    @@index([diaEstudoId])
    @@index([disciplinaCronogramaId])
    @@index([diaEstudoId, ordem])
    @@map("alocacao_horario")
}

model Planejamento {
    id               Int       @id @default(autoincrement())
    dataInicio       DateTime  @map("data_inicio")
    dataFim          DateTime? @map("data_fim")
    ativo            Boolean   @default(true)
    totalHorasSemana Float     @default(0.0) @map("total_horas_semana")
    quantidadeDias   Int       @default(1) @map("quantidade_dias")
    createdAt        DateTime  @default(now()) @map("created_at")
    updatedAt        DateTime  @updatedAt @map("updated_at")

    planoEstudoId Int         @map("plano_estudo_id")
    planoEstudo   PlanoEstudo @relation(fields: [planoEstudoId], references: [id])

    diasEstudo              DiaEstudo[]
    disciplinasPlanejamento DisciplinaPlanejamento[]

    @@index([planoEstudoId])
    @@map("planejamento")
}
